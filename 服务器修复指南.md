# ğŸ”§ AIè¯¾å ‚åŠ©æ‰‹ - æœåŠ¡å™¨ä¿®å¤æŒ‡å—

## é—®é¢˜è¯Šæ–­

ä»æ‚¨çš„ç»ˆç«¯è¾“å‡ºçœ‹ï¼Œå‡ºç°äº†ä»¥ä¸‹é—®é¢˜ï¼š
1. âŒ é¡¹ç›®æ–‡ä»¶ç»“æ„ä¸å®Œæ•´ï¼ˆç¼ºå°‘ backend ç›®å½•ã€package.json ç­‰ï¼‰
2. âŒ æƒé™é—®é¢˜ï¼ˆé˜²ç«å¢™é…ç½®ã€æ—¥å¿—æ–‡ä»¶å†™å…¥ï¼‰
3. âŒ æœåŠ¡å¯åŠ¨å¤±è´¥

## è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤1: æ£€æŸ¥å½“å‰ç›®å½•å’Œæ–‡ä»¶ç»“æ„

```bash
# æ£€æŸ¥å½“å‰ä½ç½®
pwd
ls -la

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å…³é”®æ–‡ä»¶/ç›®å½•ï¼š
# - package.json
# - backend/
# - requirements.txt
# - README.md
```

### æ­¥éª¤2: å¦‚æœæ–‡ä»¶ä¸å®Œæ•´ï¼Œé‡æ–°è§£å‹é¡¹ç›®

```bash
# å¦‚æœé¡¹ç›®æ–‡ä»¶ä¸å®Œæ•´ï¼Œåˆ é™¤å½“å‰ç›®å½•å¹¶é‡æ–°è§£å‹
cd /opt
sudo rm -rf ai-classroom

# é‡æ–°è§£å‹ï¼ˆå‡è®¾å‹ç¼©åŒ…åœ¨ /opt ç›®å½•ï¼‰
sudo tar -xzf ai-classroom.tar.gz
cd ai-classroom

# æ£€æŸ¥è§£å‹ç»“æœ
ls -la
```

### æ­¥éª¤3: è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™

```bash
# è®¾ç½®ç›®å½•æƒé™
sudo chown -R admin:admin /opt/ai-classroom
chmod +x server_rebuild.sh 2>/dev/null || true

# åˆ›å»ºå¿…è¦çš„ç›®å½•
mkdir -p logs
mkdir -p backend/data
mkdir -p backend/uploads
mkdir -p uploads
```

### æ­¥éª¤4: å®‰è£…ä¾èµ–

```bash
# å®‰è£… Python ä¾èµ–
python3 -m pip install --user -r requirements.txt

# å®‰è£… Node.js ä¾èµ–
npm install
```

### æ­¥éª¤5: é…ç½®é˜²ç«å¢™ï¼ˆéœ€è¦ sudo æƒé™ï¼‰

```bash
# å¦‚æœæœ‰ sudo æƒé™ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=8001/tcp
sudo firewall-cmd --reload

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo firewall-cmd --list-ports
```

### æ­¥éª¤6: å¯åŠ¨æœåŠ¡ï¼ˆä¿®å¤ç‰ˆï¼‰

```bash
# åœæ­¢å¯èƒ½å­˜åœ¨çš„æœåŠ¡
pkill -f "working_server.py" 2>/dev/null || true
pkill -f "node.*dev" 2>/dev/null || true
sleep 2

# æ‰¾åˆ°æ­£ç¡®çš„åç«¯è„šæœ¬å¹¶å¯åŠ¨
if [ -f "backend/working_server.py" ]; then
    nohup python3 backend/working_server.py > logs/backend.log 2>&1 &
    echo "åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ŒPID: $!"
elif [ -f "backend/run.py" ]; then
    nohup python3 backend/run.py > logs/backend.log 2>&1 &
    echo "åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ŒPID: $!"
elif [ -f "run.py" ]; then
    nohup python3 run.py > logs/backend.log 2>&1 &
    echo "åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ŒPID: $!"
else
    echo "âŒ æ‰¾ä¸åˆ°åç«¯å¯åŠ¨è„šæœ¬"
fi

# ç­‰å¾…åç«¯å¯åŠ¨
sleep 3

# å¯åŠ¨å‰ç«¯æœåŠ¡
nohup npm run dev > logs/frontend.log 2>&1 &
echo "å‰ç«¯æœåŠ¡å·²å¯åŠ¨ï¼ŒPID: $!"

# ç­‰å¾…å‰ç«¯å¯åŠ¨
sleep 5
```

### æ­¥éª¤7: æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep -E "(node|python3)" | grep -v grep

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E ":3000|:8001" || ss -tlnp | grep -E ":3000|:8001"

# æ£€æŸ¥æ—¥å¿—
echo "=== åç«¯æ—¥å¿— ==="
tail -10 logs/backend.log

echo "=== å‰ç«¯æ—¥å¿— ==="
tail -10 logs/frontend.log
```

### æ­¥éª¤8: æµ‹è¯•æœåŠ¡

```bash
# æµ‹è¯•åç«¯API
curl -s http://localhost:8001/api/courses

# æµ‹è¯•å‰ç«¯é¡µé¢
curl -s http://localhost:3000
```

## ä¸€é”®ä¿®å¤è„šæœ¬

å¦‚æœæ‚¨æƒ³ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œè¯·å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°æœåŠ¡å™¨ï¼š

```bash
# åˆ›å»ºä¿®å¤è„šæœ¬
cat > fix_deployment.sh << 'EOF'
#!/bin/bash

echo "ğŸ”§ ä¿®å¤ AIè¯¾å ‚åŠ©æ‰‹éƒ¨ç½²é—®é¢˜..."

# æ£€æŸ¥åŸºæœ¬ç¯å¢ƒ
if [ ! -f "package.json" ]; then
    echo "âŒ å½“å‰ç›®å½•æ²¡æœ‰ package.jsonï¼Œè¯·ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ"
    exit 1
fi

# åˆ›å»ºç›®å½•
mkdir -p logs backend/data backend/uploads uploads

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
python3 -m pip install --user -r requirements.txt
npm install

# åœæ­¢å·²æœ‰æœåŠ¡
echo "â¹ï¸ åœæ­¢å·²æœ‰æœåŠ¡..."
pkill -f "working_server.py\|node.*dev" 2>/dev/null || true
sleep 2

# å¯åŠ¨åç«¯
echo "ğŸš€ å¯åŠ¨åç«¯..."
if [ -f "backend/working_server.py" ]; then
    nohup python3 backend/working_server.py > logs/backend.log 2>&1 &
elif [ -f "run.py" ]; then
    nohup python3 run.py > logs/backend.log 2>&1 &
fi
sleep 3

# å¯åŠ¨å‰ç«¯
echo "ğŸŒ å¯åŠ¨å‰ç«¯..."
nohup npm run dev > logs/frontend.log 2>&1 &
sleep 5

# æ˜¾ç¤ºçŠ¶æ€
echo "ğŸ“Š æœåŠ¡çŠ¶æ€:"
ps aux | grep -E "(node|python3)" | grep -v grep
echo ""
echo "ğŸŒ è®¿é—®åœ°å€: http://$(curl -s ifconfig.me):3000"
echo "ğŸ”§ APIåœ°å€: http://$(curl -s ifconfig.me):8001"
echo ""
echo "ğŸ“‹ æ—¥å¿—æŸ¥çœ‹:"
echo "  åç«¯: tail -f logs/backend.log"
echo "  å‰ç«¯: tail -f logs/frontend.log"

EOF

# è¿è¡Œä¿®å¤è„šæœ¬
chmod +x fix_deployment.sh
./fix_deployment.sh
```

## å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: æƒé™è¢«æ‹’ç»
```bash
# è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ sudo æˆ–ä¿®æ”¹æ–‡ä»¶æƒé™
sudo chown -R $USER:$USER /opt/ai-classroom
```

### é—®é¢˜2: ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000,8001

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 $(lsof -t -i:3000,8001)
```

### é—®é¢˜3: ä¾èµ–å®‰è£…å¤±è´¥
```bash
# Python ä¾èµ–
python3 -m pip install --upgrade pip
python3 -m pip install --user -r requirements.txt

# Node.js ä¾èµ–
npm cache clean --force
npm install
```

### é—®é¢˜4: æœåŠ¡æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥é˜²ç«å¢™
sudo firewall-cmd --list-ports

# æ·»åŠ ç«¯å£è§„åˆ™
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=8001/tcp
sudo firewall-cmd --reload
```

## éªŒè¯éƒ¨ç½²æˆåŠŸ

1. **æ£€æŸ¥è¿›ç¨‹**ï¼š`ps aux | grep -E "(node|python3)"`
2. **æ£€æŸ¥ç«¯å£**ï¼š`netstat -tlnp | grep -E ":3000|:8001"`
3. **æµ‹è¯•è®¿é—®**ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://YOUR_SERVER_IP:3000`
4. **æ£€æŸ¥æ—¥å¿—**ï¼š`tail -f logs/backend.log` å’Œ `tail -f logs/frontend.log`

## æˆåŠŸæ ‡å¿—

âœ… èƒ½å¤Ÿçœ‹åˆ° Node.js å’Œ Python3 è¿›ç¨‹è¿è¡Œ  
âœ… ç«¯å£ 3000 å’Œ 8001 è¢«ç›‘å¬  
âœ… å‰ç«¯é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®  
âœ… åç«¯ API å“åº”æ­£å¸¸  

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚ 